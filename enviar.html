<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enviar Receita - Confeitaria Criativa</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        :root {
            --color-primary: #D9A679;
            --color-primary-dark: #8C6B4F;
            --color-title: #260B01;
            --color-background-soft: #D9CEC1;
            --color-accent: #593312;
        }
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--color-title);
            color: var(--color-background-soft);
        }
        h1, h2, h3, label {
            font-family: 'Playfair Display', serif;
        }
        .form-input {
            width: 100%;
            padding: 0.75rem;
            border-radius: 0.5rem;
            border: 1px solid var(--color-primary-dark);
            background-color: var(--color-accent);
            color: var(--color-background-soft);
            transition: all 0.3s ease;
        }
        .form-input:focus {
            outline: none;
            border-color: var(--color-primary);
            box-shadow: 0 0 0 2px rgba(217, 166, 121, 0.5);
        }
        .form-label {
            display: block;
            font-weight: 500;
            margin-bottom: 0.5rem;
        }
        .btn-primary {
            background-color: var(--color-primary);
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 9999px;
            font-weight: bold;
            transition: background-color 0.3s;
        }
        .btn-primary:hover {
            background-color: var(--color-primary-dark);
        }
    </style>
</head>
<body>

    <header class="bg-[var(--color-title)]/70 backdrop-blur-sm shadow-lg sticky top-0 z-20">
        <nav class="container mx-auto px-6 py-4 flex justify-between items-center">
            <div class="text-2xl font-bold text-[var(--color-primary)]">
                <a href="index.html">Confeitaria Criativa</a>
            </div>
            <div class="hidden md:flex space-x-6 items-center">
                <a href="index.html#categorias" class="text-[var(--color-accent)] hover:text-[var(--color-primary)]">Categorias</a>
                <a href="#" class="bg-[var(--color-primary)] text-white px-4 py-2 rounded-full hover:bg-[var(--color-primary-dark)] transition-colors">Enviar Receita</a>
            </div>
            <div class="md:hidden">
                <button class="text-[var(--color-accent)] hover:text-[var(--color-primary)]">
                    <i data-lucide="menu"></i>
                </button>
            </div>
        </nav>
    </header>

    <main class="container mx-auto px-6 py-12">
        <div class="max-w-4xl mx-auto bg-[var(--color-accent)]/60 backdrop-blur-md p-8 rounded-2xl shadow-lg">
            <h1 class="text-5xl font-bold text-center text-white mb-8">Enviar Nova Receita</h1>
            <form id="recipe-form" class="space-y-6">
                <div class="bg-[var(--color-title)]/50 p-6 rounded-xl">
                    <h2 class="text-2xl font-bold mb-4">Informações da Receita</h2>
                    <div>
                        <label for="recipe-name" class="form-label">Nome da Receita</label>
                        <input type="text" id="recipe-name" class="form-input" required>
                    </div>
                    <div>
                        <label for="recipe-category" class="form-label">Categoria</label>
                        <select id="recipe-category" class="form-input" required>
                            <option value="">Selecione uma categoria...</option>
                        </select>
                    </div>
                    <div>
                        <label for="recipe-image" class="form-label">Link da Imagem</label>
                        <input type="url" id="recipe-image" class="form-input" placeholder="Ex: https://link-da-imagem.jpg">
                    </div>
                    <div>
                        <label for="recipe-description" class="form-label">Descrição / Observações</label>
                        <textarea id="recipe-description" class="form-input" rows="3"></textarea>
                    </div>
                </div>

                <div class="bg-[var(--color-title)]/50 p-6 rounded-xl">
                    <h2 class="text-2xl font-bold mb-4">Ingredientes</h2>
                    <div id="ingredients-container" class="space-y-4">
                        <div class="flex space-x-4">
                            <div class="w-2/3">
                                <label class="form-label">Nome do Ingrediente</label>
                                <input type="text" class="ingredient-name form-input" placeholder="Farinha de trigo">
                            </div>
                            <div class="w-1/3">
                                <label class="form-label">Porcentagem (%)</label>
                                <input type="number" step="0.1" class="ingredient-percentage form-input" placeholder="50.0">
                            </div>
                        </div>
                    </div>
                    <button type="button" id="add-ingredient-btn" class="mt-4 w-full bg-transparent border border-[var(--color-primary)] text-[var(--color-primary)] px-4 py-2 rounded-lg hover:bg-[var(--color-primary)] hover:text-white transition-colors">Adicionar Ingrediente</button>
                </div>

                <div class="bg-[var(--color-title)]/50 p-6 rounded-xl">
                    <h2 class="text-2xl font-bold mb-4">Modo de Preparo</h2>
                    <div id="method-container" class="space-y-4">
                        <div>
                            <label class="form-label">Passo 1</label>
                            <textarea class="method-step form-input" rows="2"></textarea>
                        </div>
                    </div>
                    <button type="button" id="add-method-btn" class="mt-4 w-full bg-transparent border border-[var(--color-primary)] text-[var(--color-primary)] px-4 py-2 rounded-lg hover:bg-[var(--color-primary)] hover:text-white transition-colors">Adicionar Passo</button>
                </div>

                <div class="text-center">
                    <button type="submit" class="btn-primary">Gerar Receita JSON</button>
                </div>
                
                <div id="result-area" class="mt-8 hidden">
                    <h3 class="text-2xl font-bold mb-4">Receita Gerada em JSON</h3>
                    <p class="text-[var(--color-background-soft)] mb-4">Copie o conteúdo abaixo e adicione ao seu arquivo `receitas.json`.</p>
                    <textarea id="json-output" class="form-input w-full h-64 text-sm" readonly></textarea>
                </div>

            </form>
        </div>
    </main>

    <footer class="bg-[var(--color-title)]/80 text-[var(--color-background-soft)] mt-16">
        <div class="container mx-auto px-6 py-8 text-center">
            <p>&copy; 2024 Confeitaria Criativa. Todos os direitos reservados.</p>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const recipeForm = document.getElementById('recipe-form');
            const recipeNameInput = document.getElementById('recipe-name');
            const recipeCategorySelect = document.getElementById('recipe-category');
            const recipeImageInput = document.getElementById('recipe-image');
            const recipeDescriptionTextarea = document.getElementById('recipe-description');
            const ingredientsContainer = document.getElementById('ingredients-container');
            const addIngredientBtn = document.getElementById('add-ingredient-btn');
            const methodContainer = document.getElementById('method-container');
            const addMethodBtn = document.getElementById('add-method-btn');
            const jsonOutputTextarea = document.getElementById('json-output');
            const resultArea = document.getElementById('result-area');

            // Categorias existentes baseadas em receitas.json
            const categories = [
                "Pudins e Flans",
                "Bolos",
                "Tortas",
                "Doces Tradicionais",
                "Biscoitos e Petit Fours",
                "Salgados",
                "Pães e Massas Doces",
                "Bombons e Trufas",
                "Massas Base",
                "Sobremesas Geladas",
                "Cremes e Recheios",
                "Caldas e Coberturas",
                "Montagem e Decoração",
                "Preparações Base"
            ];
            
            categories.forEach(category => {
                const option = document.createElement('option');
                option.value = category;
                option.textContent = category;
                recipeCategorySelect.appendChild(option);
            });

            addIngredientBtn.addEventListener('click', () => {
                const newIngredient = document.createElement('div');
                newIngredient.className = 'flex space-x-4';
                newIngredient.innerHTML = `
                    <div class="w-2/3">
                        <label class="form-label">Nome do Ingrediente</label>
                        <input type="text" class="ingredient-name form-input" placeholder="Nome do Ingrediente">
                    </div>
                    <div class="w-1/3">
                        <label class="form-label">Porcentagem (%)</label>
                        <input type="number" step="0.1" class="ingredient-percentage form-input" placeholder="0.0">
                    </div>
                `;
                ingredientsContainer.appendChild(newIngredient);
            });

            addMethodBtn.addEventListener('click', () => {
                const newStep = document.createElement('div');
                const stepCount = methodContainer.children.length + 1;
                newStep.innerHTML = `
                    <div>
                        <label class="form-label">Passo ${stepCount}</label>
                        <textarea class="method-step form-input" rows="2"></textarea>
                    </div>
                `;
                methodContainer.appendChild(newStep);
            });

            recipeForm.addEventListener('submit', (event) => {
                event.preventDefault();

                const recipeName = recipeNameInput.value.trim();
                const recipeKey = recipeName.toLowerCase().replace(/ç/g, 'c').replace(/ã/g, 'a').replace(/õ/g, 'o').replace(/\s+/g, '_');
                const category = recipeCategorySelect.value;
                const image = recipeImageInput.value.trim();
                const description = recipeDescriptionTextarea.value.trim();

                const ingredients = [];
                let totalPercentage = 0;
                const ingredientInputs = ingredientsContainer.querySelectorAll('.ingredient-name');
                ingredientInputs.forEach(input => {
                    const name = input.value.trim();
                    const percentage = input.parentElement.nextElementSibling.querySelector('input').value;
                    if (name && percentage) {
                        const parsedPercentage = parseFloat(percentage.replace(',', '.'));
                        ingredients.push({ name: name, percentage: parsedPercentage.toFixed(1) });
                        totalPercentage += parsedPercentage;
                    }
                });

                const methods = [];
                const methodInputs = methodContainer.querySelectorAll('.method-step');
                methodInputs.forEach(input => {
                    const step = input.value.trim();
                    if (step) {
                        methods.push(step);
                    }
                });

                // Validação
                if (totalPercentage > 100.1 || totalPercentage < 99.9) {
                    alert('A soma das porcentagens dos ingredientes deve ser aproximadamente 100%. A soma atual é ' + totalPercentage.toFixed(1) + '%.');
                    return;
                }
                
                if (ingredients.length === 0 || methods.length === 0) {
                     alert('Por favor, adicione pelo menos um ingrediente e um passo do modo de preparo.');
                    return;
                }

                const newRecipe = {
                    [recipeKey]: {
                        "name": recipeName,
                        "category": category,
                        "icon": "fa-solid fa-utensils",
                        "image": image || "https://placehold.co/600x400/D9A679/260B01?text=Imagem+Indisponível",
                        "description": description,
                        "ingredients": ingredients.map(ing => ({
                            name: ing.name,
                            percentage: String(ing.percentage).replace('.', ',')
                        })),
                        "method": methods
                    }
                };

                jsonOutputTextarea.value = JSON.stringify(newRecipe, null, 4);
                resultArea.classList.remove('hidden');
                jsonOutputTextarea.select();
                alert('Receita gerada! Copie o JSON e adicione-o ao seu arquivo receitas.json.');
            });

            lucide.createIcons();
        });
    </script>
</body>
</html>