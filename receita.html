<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Receita - Delícias da Cozinha</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        h1, h2, h3 {
            font-family: 'Playfair Display', serif;
        }
        input:disabled {
            background-color: #e5e7eb;
            cursor: not-allowed;
            opacity: 0.7;
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">

    <!-- Cabeçalho -->
    <header class="bg-white shadow-sm">
        <nav class="container mx-auto px-6 py-4 flex justify-between items-center">
            <div class="text-2xl font-bold text-amber-600">
                <a href="testedinamico.html">Confeitaria</a>
            </div>
            <div class="hidden md:flex space-x-6 items-center">
                <a href="index.html" class="text-gray-600 hover:text-amber-600">Voltar para Home</a>
                <a href="#" class="bg-amber-500 text-white px-4 py-2 rounded-full hover:bg-amber-600 transition-colors">Enviar Receita</a>
            </div>
            <div class="md:hidden">
                <button class="text-gray-600 hover:text-amber-600">
                    <i data-lucide="menu"></i>
                </button>
            </div>
        </nav>
    </header>

    <main class="container mx-auto px-6 py-12">
        <div class="max-w-4xl mx-auto bg-white p-8 rounded-2xl shadow-lg">

            <!-- Nome da Receita -->
            <h1 id="recipe-name" class="text-5xl font-bold text-center text-amber-700 mb-8">Carregando receita...</h1>

            <!-- Seção de Cálculo -->
            <div class="bg-amber-50 p-6 rounded-xl mb-10">
                <h2 class="text-2xl font-bold mb-4 text-center">Calcular Rendimento</h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 items-end">
                    <!-- Categoria 1: Peso Total -->
                    <div class="md:col-span-1">
                        <label for="total-weight" class="block text-sm font-medium text-gray-700 mb-1">Quantidade total (kg)</label>
                        <input type="number" id="total-weight" placeholder="Ex: 1.5" class="w-full border border-gray-300 rounded-lg p-2 focus:ring-2 focus:ring-amber-400 focus:border-amber-400 transition">
                    </div>

                    <!-- Divisor -->
                    <div class="text-center text-gray-500 font-semibold md:col-span-1">OU</div>

                    <!-- Categoria 2: Por Item -->
                    <div class="grid grid-cols-2 gap-4 md:col-span-1">
                        <div>
                           <label for="item-count" class="block text-sm font-medium text-gray-700 mb-1">Qtd. de itens</label>
                           <input type="number" id="item-count" placeholder="Ex: 100" class="w-full border border-gray-300 rounded-lg p-2 focus:ring-2 focus:ring-amber-400 focus:border-amber-400 transition">
                        </div>
                        <div>
                           <label for="item-weight" class="block text-sm font-medium text-gray-700 mb-1">Peso unitário (g)</label>
                           <input type="number" id="item-weight" placeholder="Ex: 15" class="w-full border border-gray-300 rounded-lg p-2 focus:ring-2 focus:ring-amber-400 focus:border-amber-400 transition">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tabela de Ingredientes -->
            <section class="mb-10">
                <h2 class="text-3xl font-bold mb-6">Ingredientes</h2>
                <div class="overflow-x-auto">
                    <table class="min-w-full bg-white border border-gray-200 rounded-lg">
                        <thead class="bg-gray-100">
                            <tr>
                                <th class="text-left py-3 px-4 font-semibold text-sm">Ingrediente</th>
                                <th class="text-center py-3 px-4 font-semibold text-sm w-24">%</th>
                                <th class="text-center py-3 px-4 font-semibold text-sm w-32">Peso (g)</th>
                            </tr>
                        </thead>
                        <tbody id="ingredients-table">
                            <!-- Linhas de ingredientes serão inseridas aqui via JS -->
                        </tbody>
                        <tfoot class="bg-gray-100 font-bold">
                            <tr>
                                <td class="text-left py-3 px-4">Total</td>
                                <td id="total-percentage" class="text-center py-3 px-4">100</td>
                                <td id="total-weight-display" class="text-center py-3 px-4">0 g</td>
                            </tr>
                        </tfoot>
                    </table>
                </div>
            </section>

            <!-- Modo de Preparo -->
            <section class="mb-10">
                <h2 class="text-3xl font-bold mb-6">Modo de Preparo</h2>
                <ul id="method-list" class="list-decimal list-inside space-y-3 text-gray-700 leading-relaxed">
                    <!-- Passos do modo de preparo serão inseridos aqui -->
                </ul>
            </section>

            <!-- Observações -->
            <section id="observacoes">
                <h2 class="text-3xl font-bold mb-6">Observações</h2>
                <p id="recipe-description" class="text-gray-700 italic bg-gray-100 p-4 rounded-lg"></p>
            </section>

        </div>
    </main>

    <!-- Rodapé -->
    <footer class="bg-gray-800 text-white mt-16">
        <div class="container mx-auto px-6 py-8 text-center">
            <p>&copy; 2024 Delícias da Cozinha. Todos os direitos reservados.</p>
        </div>
    </footer>

    <script>
        // Elementos do DOM
        const totalWeightInput = document.getElementById('total-weight');
        const itemCountInput = document.getElementById('item-count');
        const itemWeightInput = document.getElementById('item-weight');
        const ingredientsTableBody = document.getElementById('ingredients-table');
        const totalWeightDisplay = document.getElementById('total-weight-display');
        const recipeNameH1 = document.getElementById('recipe-name');

        // Função para popular a página com os dados da receita
        function populateRecipeData(recipeData) {
            if (!recipeData) {
                recipeNameH1.textContent = "Receita não encontrada!";
                return;
            }

            recipeNameH1.textContent = recipeData.name;
            document.title = `Receita de ${recipeData.name} - Delícias da Cozinha`;
            if(!recipeData.description){
                observacoes.style.display = "none"
            }
            document.getElementById('recipe-description').textContent = recipeData.description;

            ingredientsTableBody.innerHTML = '';
            const methodList = document.getElementById('method-list');
            methodList.innerHTML = '';
            
            recipeData.ingredients.forEach(ingredient => {
                const row = document.createElement('tr');
                row.classList.add('border-b', 'border-gray-200');
                row.innerHTML = `
                    <td class="py-3 px-4">${ingredient.name}</td>
                    <td class="text-center py-3 px-4">${ingredient.percentage}</td>
                    <td class="text-center py-3 px-4 font-medium" data-percentage="${ingredient.percentage.replace(',', '.')}">0 g</td>
                `;
                ingredientsTableBody.appendChild(row);
            });

            recipeData.method.forEach(step => {
                const li = document.createElement('li');
                li.textContent = step;
                methodList.appendChild(li);
            });
        }

        function updateIngredientWeights(totalWeightGrams) {
            const weightCells = ingredientsTableBody.querySelectorAll('[data-percentage]');
            let calculatedTotalWeight = 0;

            weightCells.forEach(cell => {
                const percentage = parseFloat(cell.dataset.percentage);
                const weight = (totalWeightGrams * percentage) / 100;
                calculatedTotalWeight += weight;
                cell.textContent = `${weight.toFixed(1)} g`.replace('.', ',');
            });

            totalWeightDisplay.textContent = `${calculatedTotalWeight.toFixed(1)} g`.replace('.', ',');
        }

        function handleInputLogic() {
            const totalWeightValue = parseFloat(totalWeightInput.value);
            const itemCountValue = parseFloat(itemCountInput.value);
            const itemWeightValue = parseFloat(itemWeightInput.value);

            let finalTotalWeightGrams = 0;

            if (totalWeightInput.value.length > 0) {
                itemCountInput.disabled = true;
                itemWeightInput.disabled = true;
                if (!isNaN(totalWeightValue)) {
                    finalTotalWeightGrams = totalWeightValue * 1000;
                }
            } 
            else if (itemCountInput.value.length > 0 || itemWeightInput.value.length > 0) {
                totalWeightInput.disabled = true;
                if (!isNaN(itemCountValue) && !isNaN(itemWeightValue)) {
                    finalTotalWeightGrams = itemCountValue * itemWeightValue;
                }
            } 
            else {
                totalWeightInput.disabled = false;
                itemCountInput.disabled = false;
                itemWeightInput.disabled = false;
            }

            updateIngredientWeights(finalTotalWeightGrams);
        }
        
        async function initializePage() {
            try {
                const urlParams = new URLSearchParams(window.location.search);
                const recipeKey = urlParams.get('recipe') || 'sequilhos';

                const response = await fetch('receitas.json');
                if (!response.ok) {
                    throw new Error('Não foi possível carregar o arquivo de receitas.');
                }
                const allRecipes = await response.json();
                
                const currentRecipe = allRecipes[recipeKey];
                populateRecipeData(currentRecipe);

            } catch (error) {
                console.error("Erro ao inicializar a página:", error);
                recipeNameH1.textContent = "Erro ao carregar receita.";
            }
        }

        totalWeightInput.addEventListener('input', handleInputLogic);
        itemCountInput.addEventListener('input', handleInputLogic);
        itemWeightInput.addEventListener('input', handleInputLogic);

        document.addEventListener('DOMContentLoaded', () => {
            initializePage();
            lucide.createIcons();
        });
    </script>
</body>
</html>
